# Header: Define the diagnostic information
- set_fact:
    diag: "{{ {'항목': '로그 활성화', 'id': 8, '조치방안': 'General log, Slow log 설정'} }}"

# 8. Check and activate MySQL logging
- name: Enable General log
  mysql_query:
    login_user: root
    login_password: "rockylinux"
    query: "SET GLOBAL general_log = 'ON';"

- name: Set General log file path
  mysql_query:
    login_user: root
    login_password: "rockylinux"
    query: "SET GLOBAL general_log_file = '/var/log/mysql/mysql.log';"

- name: Enable Slow query log
  mysql_query:
    login_user: root
    login_password: "rockylinux"
    query: "SET GLOBAL slow_query_log = 'ON';"

- name: Set Slow query log file path
  mysql_query:
    login_user: root
    login_password: "rockylinux"
    query: "SET GLOBAL slow_query_log_file = '/var/log/mysql/mysql-slow.log';"

- name: Set Long query time to 1 second
  mysql_query:
    login_user: root
    login_password: "rockylinux"
    query: "SET GLOBAL long_query_time = 1;"

# Assuming 'weak' is defined as a boolean variable somewhere in your playbook
# Result evaluation block
- block:
    - debug:
        msg: "취약"  # Vulnerable
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': True, '조치방안': diag.조치방안}] }}"
  when: weak | default(false)  # Add a default to avoid undefined variable

- block:
    - debug:
        msg: "양호"  # Not vulnerable
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': False, '조치방안': diag.조치방안}] }}"
  when: not (weak | default(false))  # Add a default to avoid undefined variable

# Final result output
- name: 결과 출력
  debug:
    var: result
