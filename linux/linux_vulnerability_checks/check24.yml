# header
- set_fact:
    diag: "{{ {'항목': 'NFS 서비스 비활성화', 'id': 24, '조치방안': 'NFS 데몬(nfsd)을 중지'} }}"

# body

# 1. Check NFS process
- name: Check NFS process
  shell: "ps -ef | grep nfsd | grep -v grep"
  register: nfs_process
  ignore_errors: yes

- name: Display NFS process info
  debug:
    msg: "{{ nfs_process.stdout_lines }}"

# 2. Set weak variable based on NFS process
- set_fact:
    weak: "{{ nfs_process.stdout != '' }}"

- debug:
    msg: "Weak variable value: {{ weak }}"

- block:
    - debug:
        msg: "취약"
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': True, '조치방안': diag.조치방안}] }}"
  when: weak

- block:
    - debug:
        msg: "양호"
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': False, '조치방안': diag.조치방안}] }}"
  when: not weak
