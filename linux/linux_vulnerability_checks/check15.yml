- set_fact:
    diag: 
      { '항목': '사용자, 시스템 시작파일, 환경파일 소유자 및 권한 설정', 'id': 15 }

# SUID, SGID, Sticky bit 설정파일 확인
- name: SUID, SGID, Sticky bit 설정파일 확인
  shell: sudo find / -user root -type f \( -perm -4000 -o -perm -2000 \) -exec ls -lg {} \;
  register: suid_sgid_check
  ignore_errors: true  

# 취약점 판단
- set_fact:
    weak_suid_sgid: >
      {% if suid_sgid_check.stdout %}
        true
      {% else %}
        false
      {% endif %}

# 결과 수집
- block:
    - debug:
        msg: "취약"
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': True}] }}"
  when: weak_suid_sgid

- block:
    - debug:
        msg: "양호"
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': False}] }}"
  when: not weak_suid_sgid
