
  # 진단 항목 정보 설정
  - set_fact:
      diag: "{{ {'항목': '링크 사용 취약점', 'id': 2} }}"

  # 심볼릭 링크 사용 제한 여부 확인
  - name: 심볼릭 링크 사용 제한 여부 확인
    shell: cat /etc/httpd/conf/httpd.conf | grep FollowSymLinks
    register: SymLinks_httpd

  # 심볼릭 링크 취약점 판단
  - set_fact:
      weak_sym_links: >
        {% if SymLinks_httpd.stdout | regex_search('FollowSymLinks') %}
          true
        {% else %}
          false
        {% endif %}

  # 결과 수집 (심볼릭 링크)
  - block:
      - debug:
          msg: "심볼릭 링크 사용 취약"
      - set_fact:
          result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': True}] }}"
    when: weak_sym_links

  - block:
      - debug:
          msg: "심볼릭 링크 사용 양호"
      - set_fact:
          result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': False}] }}"
    when: not weak_sym_links

  # aliases 사용 제한 여부 확인
  - name: aliases 사용 제한 여부 확인
    shell: cat /etc/httpd/conf/httpd.conf | grep Aliases
    register: aliases_httpd

  # aliases 취약점 판단
  - set_fact:
      weak_aliases: >
        {% if aliases_httpd.stdout | regex_search('Aliases') %}
          true
        {% else %}
          false
        {% endif %}

  # 결과 수집 (aliases)
  - block:
      - debug:
          msg: "aliases 사용 취약"
      - set_fact:
          result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': True}] }}"
    when: weak_aliases

  - block:
      - debug:
          msg: "aliases 사용 양호"
      - set_fact:
          result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': False}] }}"
    when: not weak_aliases

  # 최종 결과 출력
  - name: 최종 결과
    debug:
      msg: "{{ result }}"
