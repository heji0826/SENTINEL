# 7. Ensure accounts use SHA-256 hashing algorithm
- name: Gather MySQL user accounts
  mysql_query:
    login_user: root
    login_password: "rockylinux"
    query: "SELECT user, host FROM mysql.user WHERE plugin != 'mysql_native_password' OR (plugin = 'mysql_native_password' AND authentication_string NOT LIKE '%$5$%');"
  register: users

- name: Change password hashing algorithm for users
  mysql_user:
    name: "{{ item.user }}"
    host: "{{ item.host }}"
    login_user: root
    login_password: "rockylinux"
    password: "Test123!@#"
    password_hash: 'SHA256'
  loop: "{{ users.results }}"
  when: users.results is defined and users.results | length > 0
