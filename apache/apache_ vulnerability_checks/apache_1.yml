# 진단 항목 정보 설정
- set_fact:
    diag: "{{ {'항목': 'DocumentRoot 경로', 'id': 1, '조치방안': '기본 디렉터리 변경' } }}"

# httpd.conf 파일 존재 여부 확인
- name: httpd.conf 파일 존재 여부 확인
  stat:
    path: /etc/httpd/conf/httpd.conf
  register: httpd_conf

# DocumentRoot 경로 확인 (httpd.conf)
- name: DocumentRoot 경로 확인 (httpd.conf)
  shell: cat /etc/httpd/conf/httpd.conf | grep DocumentRoot
  register: DocumentRoot_httpd
  when: httpd_conf.stat.exists

# DocumentRoot 경로 출력
- debug:
    msg: "DocumentRoot 경로: {{ DocumentRoot_httpd.stdout }}"
  when: httpd_conf.stat.exists

# 취약점 판단
- set_fact:
    weak: >
      {% if DocumentRoot_httpd.stdout | regex_search('DocumentRoot *"/var/www/html"') %}
        true
      {% else %}
        false
      {% endif %}

# 결과 수집
- block:
    - debug:
        msg: "취약"
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': True, '조치방안': diag.조치방안}] }}"
  when: weak

- block:
    - debug:
        msg: "양호"
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': False, '조치방안': diag.조치방안}]}}"
  when: not weak
