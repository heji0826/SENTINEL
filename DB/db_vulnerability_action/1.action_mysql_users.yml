# Header
- set_fact:
    diag: "{{ {'항목': '불필요한 MySQL 계정 확인', 'id': 1, '조치방안': '불필요한 계정 삭제'} }}"

- set_fact:
    result: []

- name: Remove unnecessary MySQL accounts
  mysql_user:
    name: "{{ item }}"
    state: absent
    login_user: root
    login_password: 'rockylinux'
  loop:
    - 'test'
    - 'guest'
    - 'anonymous'
  register: account_removal_result

# Check the removal result and classify as weak or not
- name: Check if unnecessary accounts were removed
  set_fact:
    weak: "{{ account_removal_result.changed }}"

# Result block for when removal was successful (changed = true)
- block:
    - debug:
        msg: "취약"
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': True, '조치방안': diag.조치방안}] }}"
  when: weak

# Result block for when no accounts needed removal (changed = false)
- block:
    - debug:
        msg: "양호"
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': False, '조치방안': diag.조치방안}] }}"
  when: not weak

- name: 최종 결과 출력
  debug:
    var: result
