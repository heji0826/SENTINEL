# header
- set_fact:
    diag: "{{ {'항목': 'tftp, talk 서비스 비활성화', 'id': 29} }}"

# body

# 1. Check tftp service status
- name: Check tftp service status
  command: "systemctl is-active tftp"
  register: tftp_status
  ignore_errors: yes

- name: Display tftp service status
  debug:
    msg: "tftp 서비스 상태: {{ tftp_status.stdout | default('서비스 없음') }}"

# 2. Check talk service status
- name: Check talk service status
  command: "systemctl is-active talk"
  register: talk_status
  ignore_errors: yes

- name: Display talk service status
  debug:
    msg: "talk 서비스 상태: {{ talk_status.stdout | default('서비스 없음') }}"

# 3. Final result for tftp service
- block:
    - debug:
        msg: "tftp 서비스가 활성화되어 있어 취약합니다."
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': True}] }}"
  when: tftp_status.rc == 0  # tftp 서비스가 활성화되어 있는 경우

- block:
    - debug:
        msg: "tftp 서비스가 비활성화되어 있어 양호합니다."
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': False}] }}"
  when: tftp_status.rc != 0  # tftp 서비스가 비활성화되어 있는 경우 또는 서비스가 없음

# 4. Final result for talk service
- block:
    - debug:
        msg: "talk 서비스가 활성화되어 있어 취약합니다."
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': True}] }}"
  when: talk_status.rc == 0  # talk 서비스가 활성화되어 있는 경우

- block:
    - debug:
        msg: "talk 서비스가 비활성화되어 있어 양호합니다."
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': False}] }}"
  when: talk_status.rc != 0  # talk 서비스가 비활성화되어 있는 경우 또는 서비스가 없음
