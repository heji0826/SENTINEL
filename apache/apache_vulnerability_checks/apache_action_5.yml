# Ensure /etc/httpd/conf/httpd.conf exists
- name: Ensure httpd.conf exists
  stat:
    path: /etc/httpd/conf/httpd.conf
  register: httpd_conf

# Search for "Indexes" option in httpd.conf
- name: Search for "Indexes" option in httpd.conf
  shell: grep -E "^\s*Options.*Indexes" /etc/httpd/conf/httpd.conf
  register: indexes_option
  failed_when: false
  changed_when: false

# Comment out the "Indexes" option if present
- name: Comment out the Indexes option if present
  lineinfile:
    path: /etc/httpd/conf/httpd.conf
    regexp: '^(\s*Options.*Indexes.*)$'
    line: '# \\1'  # backreference 사용 시 이스케이프 필요
    backrefs: yes
  when: indexes_option.stdout != ""
  notify: Restart Apache

- block:
    # Restart Apache (notify handler)
    - name: Restart Apache
      service:
        name: httpd
        state: restarted
