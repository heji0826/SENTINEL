# Header: Set diagnostic information
- set_fact:
    diag: "{{ {'항목': 'DB 사용자 계정 정보 테이블 접근 권한', 'id': 4, '조치방안': '일반 사용자 계정의 권한 제거'} }}"

- set_fact:
    result: []

# 4. Revoke all privileges from the specified user
- name: Revoke all privileges from user
  mysql_user:
    login_user: root
    login_password: "rockylinux"
    name: "test"
    host: "localhost"
    priv: "*.*:ALL"
    state: absent
  register: revoke_privileges

- name: Verify revoked privileges
  debug:
    var: revoke_privileges

# Result block for when privileges were revoked
- block:
    - debug:
        msg: "취약"
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': True, '조치방안': diag.조치방안}] }}"
  when: revoke_privileges.changed

# Result block for when no privileges were revoked
- block:
    - debug:
        msg: "양호"
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': False, '조치방안': diag.조치방안}] }}"
  when: not revoke_privileges.changed

- name: 최종 결과 출력
  debug:
    var: result
