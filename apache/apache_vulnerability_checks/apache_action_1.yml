- set_fact:
    diag: "{{ { '항목': '웹 서비스 영역의 분리 조치', 'id': 1, '조치방안': '1. DocumentRoot 경로 수정, 2. Apache 재시작' } }}"

# httpd.conf 파일 존재 여부 확인
- name: httpd.conf 파일 존재 여부 확인
  stat:
    path: /etc/httpd/conf/httpd.conf
  register: httpd_conf

# DocumentRoot 설정 확인
- name: DocumentRoot 설정 확인
  shell: cat /etc/httpd/conf/httpd.conf | grep '^ *DocumentRoot'
  register: DocumentRoot_check
  ignore_errors: true

# 경로 추출
- set_fact:
    document_root_path: >
      {% if DocumentRoot_check.stdout %}
        {{ DocumentRoot_check.stdout | regex_search('^ *DocumentRoot +(.*)$') | first }}
      {% else %}
        "경로 없음"
      {% endif %} 

# regex_search 결과 확인
- set_fact:
    regex_result: >
      {{ DocumentRoot_check.stdout.strip() | regex_search('/var/www/html') is not none }}


- block:
  - name: DocumentRoot 경로 변경
    replace:
      path: /etc/httpd/conf/httpd.conf
      regexp: '^ *DocumentRoot +/var/www/html'
      replace: 'DocumentRoot "/var/security_apache"'
    when: not regex_result or document_root_path != "경로 없음"

  - name: Apache 재시작
    service:
      name: httpd
      state: restarted
    when: not regex_result or document_root_path != "경로 없음"
