# 헤더
- set_fact:
    diag: "{{ {'항목': 'DB 사용자 계정 정보 테이블 접근 권한', 'id': 4, '조치방안': '일반 사용자 계정의 권한 제거'} }}"

- name: Check privileges for user
  mysql_user:
    login_user: root
    login_password: "hello"  # MySQL root 비밀번호를 직접 입력
    name: "test"  # 권한을 확인할 사용자 이름
    host: "localhost"  # 권한을 확인할 호스트
    state: present  # 사용자 존재 여부 확인
  register: check_result
  failed_when: false 

- name: Check if the password policy requirement is not satisfied
  debug:
    msg: "Password policy requirement is not satisfied."
  when: "'policy requirements' in check_result.msg"

- name: Show user privileges if no errors
  debug:
    var: check_result
  when: "'policy requirements' not in check_result.msg"

# 결과 처리
- block:
    - debug:
        msg: "취약"
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': True, '조치방안': diag.조치방안}] }}"
  when: "'policy requirements' in check_result.msg"

- block:
    - debug:
        msg: "양호"
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': False, '조치방안': diag.조치방안}] }}"
  when: "'policy requirements' not in check_result.msg"

