# header
- set_fact:
    diag: "PermitRootLogin Check"  ## 점검 내용 이름
    num: 1 ## 점검 번호

# body

# Get PermitRootLogin setting from sshd_config
- name: Get PermitRootLogin setting from sshd_config
  ansible.builtin.shell: grep -E '^[[:space:]]*PermitRootLogin' /etc/ssh/sshd_config
  register: permit_root_login
  ignore_errors: yes

# weak?
- set_fact:
    weak: |
      {% if permit_root_login.rc != 0 %}
        true  # 설정이 없는 경우 취약함
      {% elif 'PermitRootLogin no' in permit_root_login.stdout %}
        false  # 안전함
      {% elif 'PermitRootLogin prohibit-password' in permit_root_login.stdout %}
        true  # prohibit-password
      {% else %}
        true  # 취약함 (기타 경우)
      {% endif %}

# Show the weak variable value
- debug:
    msg: "Weak variable value: {{ weak }}"

# result
- block:
    - debug:
        msg: "취약"
    - set_fact:
        result: "{{ (result | default([])) + [{'num': num, 'diag': diag, 'weak': true}] }}"
  when: weak | bool

- block:
    - debug:
        msg: "양호"
    - set_fact:
        result: "{{ (result | default([])) + [{'num': num, 'diag': diag, 'weak': false}] }}"
  when: not (weak | bool)

# Current result debug
- debug:
    msg: "Current result: {{ result }}"
