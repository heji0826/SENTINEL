- set_fact:
    diag: "{{ {'항목': '취약한 패스워드 사용 제한', 'id': 2, '조치방안': '패스워드 최소 길이 설정'} }}"

# 패스워드 최소 길이 확인
- name: Check minimum password length
  mysql_query:
    query: "SHOW VARIABLES LIKE 'validate_password.length';"
    login_user: root
    login_password: 'hello'  # 실제 비밀번호로 변경하세요
  register: password_length

- name: Debug password length query result
  debug:
    var: password_length.query_result

# 결과 처리
- set_fact:
    weak: false

# 취약성 체크: 결과가 있을 때만 패스워드 길이 확인
- set_fact:
    weak: true
  when: 
    - password_length.query_result | length > 0  # 결과가 있을 때만 확인
    - password_length.query_result[0][1] is defined  # 값이 정의되어 있을 때 확인
    - password_length.query_result[0][1] | int < 8

# 결과 추가
- block:
    - debug:
        msg: "취약"
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': True, '조치방안': diag.조치방안}] }}"

  when: weak

- block:
    - debug:
        msg: "양호"
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': False, '조치방안': diag.조치방안}] }}"

  when: not weak
