---
# header
- set_fact:
    diag: "{{ {'항목': '최신 보안 패치 적용', 'id': 7, '조치방안': 'apache 최신 버전으로 업데이트'} }}"

# body

# 1. Check Apache version
- name: Get Apache version
  shell: "httpd -v | grep 'Server version' | awk '{print $3}' | cut -d'/' -f2"
  register: apache_version
  ignore_errors: yes

- name: Display Apache version
  debug:
    msg: "{{ apache_version.stdout }}"

# 2. Set weak variable based on Apache version
- set_fact:
    weak: "{{ (apache_version.stdout is defined) and (apache_version.stdout is version('2.3.0', '<')) }}"

- debug:
    msg: "Weak variable value: {{ weak }}"

# result
- block:
    - debug:
        msg: "취약"
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': True, '조치방안': diag.조치방안}] }}"
  when: weak

- block:
    - debug:
        msg: "양호"
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': False, '조치방안': diag.조치방안}] }}"
  when: not weak
