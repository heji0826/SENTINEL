# header
- set_fact:
    diag: "{{ {'항목': 'automountd 제거', 'id': 26} }}"

# body

# 1. Check automountd process
- name: Check automountd process
  shell: "ps -ef | grep automountd | grep -v grep"
  register: automountd_process
  ignore_errors: yes

- name: Display automountd process info
  debug:
    msg: "{{ automountd_process.stdout_lines }}"

# 2. Check if automountd is running
- set_fact:
    is_running: "{{ automountd_process.stdout != '' }}"

- debug:
    msg: "Is automountd running: {{ is_running }}"

# 3. Final result
- block:
    - debug:
        msg: "취약"
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': True}] }}"
  when: is_running

- block:
    - debug:
        msg: "양호"
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': False}] }}"
  when: not is_running
