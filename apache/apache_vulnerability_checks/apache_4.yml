
# 진단 항목 정보 설정
- set_fact:
    diag: "{{ { '항목': ' 파일 업로드 및 다운로드 제한', 'id': 4, '조치방안': '파일 업로드 및 다운로드 용량 제한 설정' } }}"


- name: 
  shell: cat /etc/httpd/conf/httpd.conf | grep LimitRequestBody
  register: LimitRequestBody_httpd
  ignore_errors: true  # grep 결과가 없을 경우 오류를 무시

- set_fact:
    weak: >
      {% if LimitRequestBody_httpd.stdout | regex_search('LimitRequestBody') %}
        false
      {% elif LimitRequestBody_httpd is not defined  %} 
        true
      {% else %}
        true
      {% endif %}
  

- block:
    - debug:
        msg: "취약"
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': True, '조치방안': diag.조치방안 }] }}"
  when: weak

- block:
    - debug:
        msg: "양호"
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': False, '조치방안': diag.조치방안}] }}"
  when: not weak


