# 9. Check and update MySQL version if necessary
- name: Get MySQL current version
  shell: "mysql -V | awk '{ print $5 }' | cut -d',' -f1"
  register: mysql_version
  ignore_errors: yes

- name: Show MySQL version
  debug:
    var: mysql_version.stdout

- name: Check available MySQL version from repository
  shell: "yum info mysql-server | grep Version"
  register: mysql_available_version
  ignore_errors: yes

- name: Compare installed version with latest version
  set_fact:
    mysql_update_required: "{{ mysql_version.stdout is version(mysql_available_version.stdout, '<') }}"

- name: Update MySQL if not up-to-date
  dnf:
    name: mysql-server
    state: latest
  when: mysql_update_required

- name: MySQL is up-to-date
  debug:
    msg: "MySQL is up-to-date. Installed version: {{ mysql_version.stdout }}."
  when: not mysql_update_required
