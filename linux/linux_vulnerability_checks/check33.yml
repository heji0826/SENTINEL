- set_fact:
    diag: "{{ {'항목': 'DNS  보안 버전 패치', 'id': 33} }}"  # 항목명과 ID 설정

- name: Check if DNS service (BIND) is running
  shell: ps -ef | grep named
  register: bind_process_status
  ignore_errors: yes

- name: Display BIND running status
  debug:
    msg: "{{ 'BIND is running' if bind_process_status.stdout and 'grep' not in bind_process_status.stdout else 'BIND is not running' }}"

- name: Check BIND version
  shell: named -v
  register: bind_version
  ignore_errors: yes
  failed_when: bind_version.rc not in [0, 127]  # 명령이 실패한 것으로 간주할 조건 설정

- name: Handle BIND version output
  block:
    - name: Display BIND version
      debug:
        msg: "{{ bind_version.stdout if bind_version.stdout else 'BIND is not installed or version information not available' }}"
  when: bind_version.rc == 0  # 명령이 성공적으로 실행된 경우에만 출력

- name: Notify if BIND version command not found
  debug:
    msg: "The 'named' command was not found. BIND may not be installed."
  when: bind_version.rc == 127  # 'named' 명령이 없을 때만 출력

# 취약/양호 여부에 따른 결과 업데이트
- block:
    - debug:
        msg: "취약"
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': True}] }}"
  when: bind_process_status.stdout == ""  # BIND가 실행 중이지 않을 경우 취약

- block:
    - debug:
        msg: "양호"
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': False}] }}"
  when: bind_process_status.stdout != ""  # BIND가 실행 중일 경우 양호
