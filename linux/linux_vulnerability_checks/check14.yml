- set_fact:
    diag: "{{{ '항목': 'SUID, SGID, Sticky bit 설정 파일 점검', 'id': 14, '조치방안': 'SUID, SGID Sticky bit 설정 파일 제거 및 주기적인 감사 및 반드시 사용이 필요한 경우 특정 그룹에서만 사용하도록 제한(일반 사용자의 Setuid 사용을 제한함, 임의의 그룹만 가능)' }}}"

# SUID, SGID, Sticky bit 설정파일 확인
- name: SUID, SGID, Sticky bit 설정파일 확인
  shell: sudo find / -user root -type f \( -perm -4000 -o -perm -2000 \) -exec ls -lg {} \;
  register: suid_sgid_check
  ignore_errors: true  

# 취약점 판단
- set_fact:
    weak_suid_sgid: >
      {% if suid_sgid_check.stdout %}
        true
      {% else %}
        false
      {% endif %}

# 결과 수집
- block:
    - debug:
        msg: "취약"
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': True, '조치방안': diag.조치방안 }] }}"
  when: weak_suid_sgid

- block:
    - debug:
        msg: "양호"
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': False, '조치방안': diag.조치방안}] }}"
  when: not weak_suid_sgid
