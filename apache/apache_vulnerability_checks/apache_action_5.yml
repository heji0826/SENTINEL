# Ensure /etc/httpd/conf/httpd.conf exists
- name: Ensure httpd.conf exists
  stat:
    path: /etc/httpd/conf/httpd.conf
  register: httpd_conf


# Search for "Indexes" option in httpd.conf
- name: Search for "Indexes" option in httpd.conf
  shell: grep -E "^\s*Options.*Indexes" /etc/httpd/conf/httpd.conf
  register: indexes_option
  failed_when: false
  changed_when: false

# Comment out the "Indexes" option if present
- name: Comment out the "Indexes" option if present
  become: yes
  lineinfile:
    path: /etc/httpd/conf/httpd.conf
    regexp: '^(\s*Options.*Indexes.*)$'
    line: '# \1'
    backrefs: yes
  when: indexes_option.stdout != ""
  notify:
    - Restart Apache

# Restart Apache (notify handler)
- name: Restart Apache
  become: yes
  shell: systemctl restart httpd
