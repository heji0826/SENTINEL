- set_fact:
    diag: "{{ {'항목': ' world writable 파일 점검', 'id': 16,'조치방안': '파일 존재시 설정 이유 확인 및 일반 사용자 쓰기 권한 제거'} }}"  # 항목명과 ID 설정

- name: Find top 15 world writable files
  shell: "find / -type f -perm -2 -exec ls -l {} \\; | head -n 15"
  register: world_writable_files
  ignore_errors: yes

- name: Output top 15 world writable files
  debug:
    msg: "{{ world_writable_files.stdout_lines | join('\n') }}"

- name: Too many world writable files, showing only top 15
  debug:
    msg: "파일이 너무 많아 상위 15개 항목만 표시했습니다."

- name: Count total number of world writable files
  shell: "find / -type f -perm -2 | wc -l"
  register: world_writable_files_count

- name: Output total number of world writable files
  debug:
    msg: "총 {{ world_writable_files_count.stdout }}개의 world writable 파일이 발견되었습니다."

- name: Set weak variable based on file count
  set_fact:
    weak: "{{ world_writable_files_count.stdout | int >= 100 }}"  # 100개 이상일 때 취약

- block:
    - debug:
        msg: "취약"
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': True, '조치방안': diag.조치방안}] }}"
  when: weak

- block:
    - debug:
        msg: "양호"
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': False, '조치방안': diag.조치방안}] }}"
  when: not weak
