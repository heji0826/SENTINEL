- set_fact:
    diag: "{{{ '항목': 'SUID, SGID, Sticky bit 설정 파일 점검', 'id': 14, '조치방안': '소유자 변경, 일반 사용자 쓰기 권한 제거' }}}"

# SUID, SGID, Sticky bit 설정파일 확인
- name: SUID, SGID, Sticky bit 설정파일 확인
  shell: sudo find / -user root -type f \( -perm -4000 -o -perm -2000 \) -exec ls -lg {} \;
  register: suid_sgid_check
  ignore_errors: true  

# 취약점 판단
- set_fact:
    weak_suid_sgid: >
      {% if suid_sgid_check.stdout %}
        true
      {% else %}
        false
      {% endif %}

# 결과 수집
- block:
    - debug:
        msg: "취약"
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': True, '조치방안': diag.조치방안 }] }}"
  when: weak_suid_sgid

- block:
    - debug:
        msg: "양호"
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': False, '조치방안': diag.조치방안}] }}"
  when: not weak_suid_sgid
