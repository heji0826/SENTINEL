- set_fact:
    diag: "{{ {'항목':' DoS 공격에 취약한 서비스 비활성화', 'id': 23} }}"  # 항목명과 ID 설정

- name: Check if echo service is disabled
  shell: cat /etc/xinetd.d/echo | grep disable
  register: echo_service
  ignore_errors: yes
  failed_when: echo_service.rc not in [0, 1]  # rc가 0 또는 1일 때만 실패로 간주

- name: Notify if echo service is not found or disabled
  debug:
    msg: "Echo service is not found or disabled."
  when: echo_service.rc == 1  # 'No such file or directory'가 출력될 경우

- name: Set weak variable if echo service is enabled
  set_fact:
    weak: true
  when: echo_service.rc == 0  # echo 서비스가 활성화된 경우 취약

- name: Check if discard service is disabled
  shell: cat /etc/xinetd.d/discard | grep disable
  register: discard_service
  ignore_errors: yes
  failed_when: discard_service.rc not in [0, 1]

- name: Notify if discard service is not found or disabled
  debug:
    msg: "Discard service is not found or disabled."
  when: discard_service.rc == 1

- name: Set weak variable if discard service is enabled
  set_fact:
    weak: true
  when: discard_service.rc == 0  # discard 서비스가 활성화된 경우 취약

- name: Check if daytime service is disabled
  shell: cat /etc/xinetd.d/daytime | grep disable
  register: daytime_service
  ignore_errors: yes
  failed_when: daytime_service.rc not in [0, 1]

- name: Notify if daytime service is not found or disabled
  debug:
    msg: "Daytime service is not found or disabled."
  when: daytime_service.rc == 1

- name: Set weak variable if daytime service is enabled
  set_fact:
    weak: true
  when: daytime_service.rc == 0  # daytime 서비스가 활성화된 경우 취약

- name: Check if chargen service is disabled
  shell: cat /etc/xinetd.d/chargen | grep disable
  register: chargen_service
  ignore_errors: yes
  failed_when: chargen_service.rc not in [0, 1]

- name: Notify if chargen service is not found or disabled
  debug:
    msg: "Chargen service is not found or disabled."
  when: chargen_service.rc == 1

- name: Set weak variable if chargen service is enabled
  set_fact:
    weak: true
  when: chargen_service.rc == 0  # chargen 서비스가 활성화된 경우 취약

- name: Set weak variable based on service status
  set_fact:
    weak: "{{ echo_service.rc == 0 or discard_service.rc == 0 or daytime_service.rc == 0 or chargen_service.rc == 0 }}"

# 취약/양호 여부에 따른 결과 업데이트
- block:
    - debug:
        msg: "취약"
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': True}] }}"
  when: weak

- block:
    - debug:
        msg: "양호"
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': False}] }}"
  when: not weak
