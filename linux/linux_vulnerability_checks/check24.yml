---
# header
- set_fact:
    diag: "{{ {'항목': 'NFS 서비스 비활성화', 'id': 24} }}"

# body

# 1. Check NFS process
- name: Check NFS process
  shell: "ps -ef | grep nfsd | grep -v grep"
  register: nfs_process
  ignore_errors: yes

- name: Display NFS process info
  debug:
    msg: "{{ nfs_process.stdout_lines }}"

# 2. Set weak variable based on NFS process
- set_fact:
    weak: "{{ nfs_process.stdout != '' }}"

- debug:
    msg: "Weak variable value: {{ weak }}"

# 3. Final result
- block:
    - debug:
        msg: "취약 - NFS 서비스가 활성화되어 있습니다."
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': True}] }}"
  when: weak

- block:
    - debug:
        msg: "양호 - NFS 서비스가 비활성화되어 있습니다."
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': False}] }}"
  when: not weak
