# header
- set_fact:
    diag: "{{ {'항목': '디렉터리 리스팅 제거', 'id': 5, '조치방안': 'Options Indexes FollowSymLinks 주석처리'} }}"

- name: Ensure /etc/httpd/conf/httpd.conf exists
  stat:
    path: /etc/httpd/conf/httpd.conf
  register: httpd_conf
  become: true

- name: Search for "Indexes" option in httpd.conf
  shell: grep -E "^\s*Options.*Indexes" /etc/httpd/conf/httpd.conf
  register: indexes_option
  failed_when: false
  changed_when: false
  become: true

- name: Comment out the "Indexes" option if present
  lineinfile:
    path: /etc/httpd/conf/httpd.conf
    regexp: '^(\s*Options.*Indexes.*)$'
    line: '# \1'
    backrefs: yes
  when: indexes_option.stdout != ""
  notify:
    - Restart Apache
  become: true
