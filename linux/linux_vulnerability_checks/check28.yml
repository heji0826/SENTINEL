- set_fact:
    diag: "{{ {'항목': 'NIS/NIS+ 서비스 점검', 'id': 28} }}"  # 항목과 ID 설정

- name: Check if NIS/NIS+ services are running
  shell: ps -ef | grep -E "ypserv|ypbind|ypxfrd|rpc.yppasswdd|rpc.ypupdated" | grep -v "grep"
  register: nis_service_check
  ignore_errors: yes

- name: Set fact based on NIS/NIS+ service status
  set_fact:
    weak: "{{ nis_service_check.stdout != '' }}"  # 서비스가 구동 중일 경우 취약으로 판>단

- name: Display NIS/NIS+ service status
  debug:
    msg: >
      {{
        'Secure: No NIS/NIS+ services are running.'
        if not weak
        else 'Vulnerable: NIS/NIS+ services are running.'
      }}

# result 업데이트 블록
- block:
    - debug:
        msg: "취약"
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': True}] }}"
  when: weak

- block:
    - debug:
        msg: "양호"
    - set_fact:
        result: "{{ result + [{'id': diag.id, '제목': diag.항목, '취약': False}] }}"
  when: not weak
